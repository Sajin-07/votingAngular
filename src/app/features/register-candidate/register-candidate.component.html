<div class="min-h-screen text-white p-4 md:p-8 flex flex-col font-inter relative overflow-hidden"
  [style.background]="'radial-gradient(circle at center, #535056 0%, #25242D 70%)'">

  <div class="absolute inset-0 opacity-5 pointer-events-none" 
       style="background-image: radial-gradient(#ffffff 1px, transparent 1px); background-size: 30px 30px;">
  </div>

  <div class="max-w-6xl mx-auto w-full flex flex-col h-full relative z-10">
    
    <header class="flex flex-col md:flex-row justify-between items-center md:items-start mb-8 gap-6 mt-2 border-b border-white/10 pb-6">
      <div class="flex flex-col items-center md:items-start text-center md:text-left">
        <div class="flex items-center gap-3 mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#529F2D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
            <path d="M9 22v-4h6v4"></path>
            <path d="M8 6h.01"></path>
            <path d="M16 6h.01"></path>
            <path d="M8 10h.01"></path>
            <path d="M16 10h.01"></path>
            <path d="M8 14h.01"></path>
            <path d="M16 14h.01"></path>
          </svg>
          <h1 class="uppercase text-2xl md:text-[28px] font-bold tracking-tight text-white">
            DataSoft Popularity Contest
          </h1>
        </div>
        <!-- <div class="flex gap-6 text-sm md:text-base pl-1">
          <p class="text-[#A1A1A1]">Vote Ends In <span class="ml-1 text-[#529F2D] font-bold font-mono">{{ timeLeft }}</span></p>
          <p class="text-[#A1A1A1]">Date <span class="ml-1 text-white font-bold">15 Dec 2025</span></p>
        </div> -->
      </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      
      <div class="lg:col-span-7" [@fadeIn]>
        <div class="bg-[#00000054] border border-[#3E3D45] rounded-xl p-6 md:p-8 shadow-[0px_4px_20px_0px_rgba(0,0,0,0.4)] relative overflow-hidden">
          
          <div *ngIf="isSubmitting" class="absolute inset-0 bg-[#25242D]/95 z-50 flex flex-col items-center justify-center">
             <div class="relative w-64 h-32 flex items-center justify-center mb-6">
                <div class="flex gap-4">
                  <div class="w-12 h-12 border-2 rounded flex items-center justify-center transition-colors duration-300"
                  [class.border-[#529F2D]]="consensusStep >= 1"
                  [class.bg-[#529F2D]/20]="consensusStep >= 1"
                  [class.animate-pulse]="consensusStep === 1">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/><polyline points="16 16 12 12 8 16"/></svg>
                  </div>
                  
                  <div class="w-8 h-0.5 bg-[#529F2D] self-center transition-all duration-500" [style.width]="consensusStep >= 2 ? '2rem' : '0'"></div>
                  
                  <div class="w-12 h-12 border-2 rounded flex items-center justify-center transition-colors duration-300"
                       [class.border-[#529F2D]]="consensusStep >= 2"
                       [class.border-gray-600]="consensusStep < 2"
                       [class.bg-[#529F2D]/20]="consensusStep >= 2">
                    <svg *ngIf="consensusStep >= 2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#529F2D" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>
                  </div>

                  <div class="w-8 h-0.5 bg-[#529F2D] self-center transition-all duration-500" [style.width]="consensusStep >= 3 ? '2rem' : '0'"></div>
                  
                  <div class="w-12 h-12 border-2 rounded flex items-center justify-center transition-colors duration-300"
                       [class.border-[#529F2D]]="consensusStep >= 3"
                       [class.border-gray-600]="consensusStep < 3"
                       [class.bg-[#529F2D]/20]="consensusStep >= 3">
                       <svg *ngIf="consensusStep >= 3" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#529F2D" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
                  </div>
                </div>
             </div>
             
             <div class="text-center">
               <h3 class="text-xl font-bold text-white mb-2">Processing Transaction</h3>
               <p class="text-[#A1A1A1] text-sm font-mono">{{ statusMessage }}</p>
             </div>
          </div>

          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold flex items-center gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#529F2D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
              </svg>
              Add New Candidate
            </h2>
            <button class="text-[#A1A1A1] hover:text-white transition-colors border border-[#3E3D45] px-3 py-1 rounded text-sm">Close</button>
          </div>

          <form [formGroup]="candidateForm" (ngSubmit)="submitToBlockchain()" class="flex flex-col gap-4">
            
            <div class="flex flex-col md:flex-row gap-4">
              <div class="flex-1">
                <label class="block text-xs text-[#A1A1A1] mb-1 ml-1 uppercase font-bold tracking-wider">Candidate ID</label>
                <input formControlName="candidateId" type="text" placeholder="e.g., C3" 
                  class="w-full h-12 bg-[#25242D] border border-[#3E3D45] rounded-lg px-4 text-white placeholder-[#535056] focus:border-[#529F2D] focus:ring-1 focus:ring-[#529F2D] outline-none transition-all"
                  [class.border-red-500]="candidateForm.get('candidateId')?.invalid && candidateForm.get('candidateId')?.touched">
                
                <div *ngIf="candidateForm.get('candidateId')?.touched" class="text-[10px] mt-1">
                   <span *ngIf="candidateForm.get('candidateId')?.hasError('required')" class="text-red-500">Required.</span>
                   <span *ngIf="candidateForm.get('candidateId')?.hasError('pattern')" class="text-red-500">Must start with 'C' followed by numbers.</span>
                   <span *ngIf="candidateForm.get('candidateId')?.hasError('idExists')" class="text-red-500 font-bold">‚ùå This Candidate ID is already registered.</span>
                   <span *ngIf="candidateForm.get('candidateId')?.pending" class="text-[#529F2D] animate-pulse">Checking Blockchain availability...</span>
                </div>
              </div>
              
              <div class="flex-[2]">
                <label class="block text-xs text-[#A1A1A1] mb-1 ml-1 uppercase font-bold tracking-wider">Full Name</label>
                <input formControlName="name" type="text" placeholder="Candidate Name" 
                  class="w-full h-12 bg-[#25242D] border border-[#3E3D45] rounded-lg px-4 text-white placeholder-[#535056] focus:border-[#529F2D] focus:ring-1 focus:ring-[#529F2D] outline-none transition-all">
              </div>
            </div>

            <div>
              <label class="block text-xs text-[#A1A1A1] mb-1 ml-1 uppercase font-bold tracking-wider">Position</label>
              <input formControlName="position" type="text" placeholder="e.g., CEO, Tech Lead" 
                class="w-full h-12 bg-[#25242D] border border-[#3E3D45] rounded-lg px-4 text-white placeholder-[#535056] focus:border-[#529F2D] focus:ring-1 focus:ring-[#529F2D] outline-none transition-all">
            </div>

            <div>
              <label class="block text-xs text-[#A1A1A1] mb-1 ml-1 uppercase font-bold tracking-wider">Campaign Description</label>
              <textarea formControlName="description" rows="3" placeholder="Slogan or Description" 
                class="w-full bg-[#25242D] border border-[#3E3D45] rounded-lg p-4 text-white placeholder-[#535056] focus:border-[#529F2D] focus:ring-1 focus:ring-[#529F2D] outline-none transition-all resize-none"></textarea>
            </div>

            <div>
              <label class="block text-xs text-[#A1A1A1] mb-1 ml-1 uppercase font-bold tracking-wider">Candidate Photo</label>
              <div class="flex gap-0 h-12">
                <label class="cursor-pointer bg-[#3E3D45] hover:bg-[#4f4c55] text-white px-6 h-full flex items-center justify-center rounded-l-lg transition-colors border-r border-[#25242D]">
                  <span class="text-sm font-semibold">Choose File</span>
                  <input type="file" (change)="onFileSelected($event)" class="hidden" accept="image/*">
                </label>
                <div class="flex-1 bg-[#25242D] border border-[#3E3D45] border-l-0 rounded-r-lg flex items-center px-4">
                  <span class="text-[#A1A1A1] text-sm truncate">{{ selectedFileName }}</span>
                </div>
              </div>
              <p class="text-[10px] text-[#529F2D] mt-1 ml-1 flex items-center gap-1">
                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                Securely hosted on IPFS/ImgBB
              </p>
            </div>

            <button type="submit" 
              [disabled]="candidateForm.invalid || isSubmitting || candidateForm.pending"
              [class.opacity-50]="candidateForm.invalid || isSubmitting"
              class="mt-4 h-[55px] w-full uppercase font-bold text-[16px] bg-gradient-to-r from-[#529F2D] to-[#1D3910] border-0 outline-none shadow-lg hover:shadow-[0_0_20px_rgba(82,159,45,0.3)] hover:from-[#5fb834] hover:to-[#234715] active:scale-95 cursor-pointer rounded-lg text-white transition-all flex items-center justify-center gap-2 group disabled:cursor-not-allowed">
              <svg class="w-5 h-5 group-hover:rotate-90 transition-transform duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Add Candidate to Blockchain
            </button>

          </form>
        </div>
      </div>
      <div class="lg:col-span-5 flex flex-col gap-4">
        <h3 class="text-lg font-bold text-white border-l-4 border-[#529F2D] pl-3">Existing Candidates</h3>
        
        <div class="bg-[#00000054] border border-[#3E3D45] rounded-xl overflow-hidden flex flex-col max-h-[600px] overflow-y-auto custom-scrollbar">
            
            <ng-container *ngIf="(candidates$ | async) as existingCandidates">
              
              <div *ngFor="let candidate of existingCandidates; let i = index" 
                   [@listAnimation]
                   class="p-4 flex items-center justify-between border-b border-[#3E3D45] last:border-0 hover:bg-[#25242D] transition-colors group">
                
                <div class="flex items-center gap-4">
                  <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#535056] to-[#25242D] border border-[#529F2D] flex items-center justify-center text-xs font-bold relative overflow-hidden">
                    <span *ngIf="!candidate.photoUrl">{{ candidate.name.substring(0,2).toUpperCase() }}</span>
                    <img *ngIf="candidate.photoUrl" [src]="candidate.photoUrl" class="w-full h-full object-cover">
                  </div>
                  
                  <div class="flex flex-col">
                      <span class="font-bold text-white group-hover:text-[#529F2D] transition-colors">{{ candidate.name }} <span class="text-[#A1A1A1] font-normal text-sm">({{ candidate.candidateId }})</span></span>
                      <span class="text-xs text-[#A1A1A1]">{{ candidate.position }}</span>
                  </div>
                </div>

                <div class="flex flex-col items-end">
                  <span class="bg-[#3E3D45] text-white text-xs font-bold px-3 py-1 rounded-full border border-[#555]">
                    {{ candidate.voteCount || 0 }} votes
                  </span>
                </div>
              </div>

              <div *ngIf="existingCandidates.length === 0" class="p-8 text-center text-[#A1A1A1]">
                  <div class="animate-pulse">Waiting for Blockchain Data...</div>
              </div>

            </ng-container>

        </div>
        
        <div class="mt-4 p-4 border border-[#3E3D45] rounded-xl bg-[#25242D]/50 relative overflow-hidden h-32 flex items-center justify-center opacity-70">
           <p class="absolute bottom-2 right-2 text-[10px] text-[#A1A1A1] font-mono">Hyperledger Fabric v2.4 Network Active</p>
            <svg width="100%" height="100%" viewBox="0 0 400 100" class="absolute inset-0">
                <path d="M50,50 Q100,20 150,50 T250,50 T350,50" fill="none" stroke="#529F2D" stroke-opacity="0.2" stroke-width="2">
                    <animate attributeName="d" dur="5s" repeatCount="indefinite" values="M50,50 Q100,20 150,50 T250,50 T350,50; M50,50 Q100,80 150,50 T250,50 T350,50; M50,50 Q100,20 150,50 T250,50 T350,50"/>
                </path>
                <circle cx="50" cy="50" r="4" fill="#529F2D" opacity="0.5"><animate attributeName="r" values="3;5;3" dur="2s" repeatCount="indefinite"/></circle>
                <circle cx="150" cy="50" r="4" fill="#529F2D" opacity="0.5"><animate attributeName="r" values="3;5;3" dur="2s" begin="0.5s" repeatCount="indefinite"/></circle>
                <circle cx="250" cy="50" r="4" fill="#529F2D" opacity="0.5"><animate attributeName="r" values="3;5;3" dur="2s" begin="1s" repeatCount="indefinite"/></circle>
            </svg>
        </div>

      </div>

      <!-- <div class="lg:col-span-5 flex flex-col gap-4">
        <h3 class="text-lg font-bold text-white border-l-4 border-[#529F2D] pl-3">Existing Candidates</h3>
        
        <div class="bg-[#00000054] border border-[#3E3D45] rounded-xl overflow-hidden flex flex-col max-h-[600px] overflow-y-auto custom-scrollbar">
            <div *ngFor="let candidate of existingCandidates; let i = index" 
                 [@listAnimation]
                 class="p-4 flex items-center justify-between border-b border-[#3E3D45] last:border-0 hover:bg-[#25242D] transition-colors group">
              
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#535056] to-[#25242D] border border-[#529F2D] flex items-center justify-center text-xs font-bold relative overflow-hidden">
                  <span *ngIf="!candidate.photoUrl">{{ candidate.name.substring(0,2).toUpperCase() }}</span>
                  <img *ngIf="candidate.photoUrl" [src]="candidate.photoUrl" class="w-full h-full object-cover">
                </div>
                
                <div class="flex flex-col">
                    <span class="font-bold text-white group-hover:text-[#529F2D] transition-colors">{{ candidate.name }} <span class="text-[#A1A1A1] font-normal text-sm">({{ candidate.candidateId }})</span></span>
                    <span class="text-xs text-[#A1A1A1]">{{ candidate.position }}</span>
                </div>
              </div>

              <div class="flex flex-col items-end">
                <span class="bg-[#3E3D45] text-white text-xs font-bold px-3 py-1 rounded-full border border-[#555]">
                  {{ candidate.voteCount || 0 }} votes
                </span>
              </div>
            </div>

            <div *ngIf="existingCandidates.length === 0" class="p-8 text-center text-[#A1A1A1]">
                <div class="animate-pulse">Loading Chain Data...</div>
            </div>
        </div>
        
        <div class="mt-4 p-4 border border-[#3E3D45] rounded-xl bg-[#25242D]/50 relative overflow-hidden h-32 flex items-center justify-center opacity-70">
            <p class="absolute bottom-2 right-2 text-[10px] text-[#A1A1A1] font-mono">Hyperledger Fabric v2.4 Network Active</p>
            <svg width="100%" height="100%" viewBox="0 0 400 100" class="absolute inset-0">
                <path d="M50,50 Q100,20 150,50 T250,50 T350,50" fill="none" stroke="#529F2D" stroke-opacity="0.2" stroke-width="2">
                    <animate attributeName="d" dur="5s" repeatCount="indefinite" values="M50,50 Q100,20 150,50 T250,50 T350,50; M50,50 Q100,80 150,50 T250,50 T350,50; M50,50 Q100,20 150,50 T250,50 T350,50"/>
                </path>
                <circle cx="50" cy="50" r="4" fill="#529F2D" opacity="0.5"><animate attributeName="r" values="3;5;3" dur="2s" repeatCount="indefinite"/></circle>
                <circle cx="150" cy="50" r="4" fill="#529F2D" opacity="0.5"><animate attributeName="r" values="3;5;3" dur="2s" begin="0.5s" repeatCount="indefinite"/></circle>
                <circle cx="250" cy="50" r="4" fill="#529F2D" opacity="0.5"><animate attributeName="r" values="3;5;3" dur="2s" begin="1s" repeatCount="indefinite"/></circle>
            </svg>
        </div>

      </div> -->

    </div>
  </div>
</div>

